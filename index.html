<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sin’s Commission Queue</title>

  <style>
  /* ================================
     Sinchanted • Commission Queue
     Pretty, readable, mobile-first
     ================================ */

  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=DM+Serif+Display:ital@0;1&display=swap');

  :root{
    --bg:#f6f6f8;
    --card:#ffffff;
    --ink:#2b2b2f;
    --muted:#6c6c76;
    --line:#e7e7ee;

    --primary:#6b4d7a;
    --ok:#4a9367;
    --warn:#d98324;
    --danger:#d64a4a;
    --info:#4a76d6;
    --shadow:0 6px 22px rgba(20,18,33,.08);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#15151a; --card:#1d1d23; --ink:#f2f2f4; --muted:#b1b1bb; --line:#2a2a33;
      --shadow:0 10px 30px rgba(0,0,0,.45);
    }
  }

  *{box-sizing:border-box}
  html{scroll-behavior:smooth;-webkit-text-size-adjust:100%}
  body{
    margin:0; padding:32px 20px;
    font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--ink); background:linear-gradient(180deg,var(--bg),#fafafb 40%,var(--bg));
    display:flex; flex-direction:column; align-items:center; gap:24px; text-align:center;
  }

  /* Header Card */
  .card{
    width:min(1000px, 96%);
    background:var(--card);
    border:1px solid var(--line);
    border-radius:18px;
    box-shadow:var(--shadow);
    padding:18px 20px;
  }
  h1{
    margin:0;
    font-family:'DM Serif Display',serif;
    font-size: clamp(2rem, 3.4vw, 3rem);
    letter-spacing:.3px;
    color:var(--ink);
  }
  .sub{ color:var(--muted); font-size:.98rem; margin-top:6px }

  /* Buttons */
  .btn{
    display:inline-block; padding:10px 14px; border-radius:999px;
    border:1px solid transparent; text-decoration:none; font-weight:600; font-size:.95rem;
    transition:.2s ease; margin:10px 6px 0 0;
  }
  .btn-primary{ background:var(--primary); color:#fff; }
  .btn-ghost{ background:transparent; color:var(--primary); border-color:var(--primary); }
  .btn:hover{ transform:translateY(-1px); box-shadow:0 6px 18px rgba(0,0,0,.08) }

  /* Table */
  .table-wrap{ width:min(1100px, 98%); margin-inline:auto }
  table{
    width:100%;
    border-collapse:separate; border-spacing:0;
    background:var(--card); border:1px solid var(--line);
    border-radius:16px; box-shadow:var(--shadow); overflow:hidden;
  }
  th, td{
    padding:14px 16px; border-bottom:1px solid var(--line);
    text-align:center; vertical-align:middle; word-break:break-word;
  }
  th{
    background:linear-gradient(180deg,rgba(0,0,0,.05),transparent);
    color:var(--ink); text-transform:uppercase; font-size:.8rem; letter-spacing:.08em;
    position:sticky; top:0; z-index:1;
  }
  tbody tr:last-child td{ border-bottom:none; }
  tbody tr:hover{ background:rgba(0,0,0,.03); }
  tbody tr:nth-child(even){ background:rgba(0,0,0,.02); }

  /* Status chips */
  .chip{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 10px; border-radius:999px; font-weight:600; font-size:.85rem;
    border:1px solid transparent;
  }
  .chip i{ font-style:normal; opacity:.8; }
  .paid{ background:rgba(74,147,103,.12); border-color:rgba(74,147,103,.3); color:var(--ok); }
  .wip{ background:rgba(217,131,36,.12); border-color:rgba(217,131,36,.3); color:var(--warn); }
  .queued{ background:rgba(74,118,214,.12); border-color:rgba(74,118,214,.3); color:var(--info); }
  .not-paid{ background:rgba(214,74,74,.12) !important; border-color:rgba(214,74,74,.35); color:var(--danger) !important; }

  .note{ color:var(--muted); font-size:.9rem; }

  /* Mobile: table → cards */
  @media (max-width: 760px){
    thead{ display:none; }
    table, tbody, tr, td{ display:block; width:100%; }
    tr{
      background:var(--card); margin:12px 0;
      border:1px solid var(--line); border-radius:14px; overflow:hidden;
    }
    td{
      border-bottom:1px solid var(--line) !important;
      display:flex; justify-content:space-between; align-items:center; gap:10px; padding:12px 14px;
    }
    td::before{
      content:attr(data-label);
      font-weight:600; color:var(--muted); text-transform:uppercase; letter-spacing:.06em;
      font-size:.78rem;
    }
    td:last-child{ border-bottom:none !important; }
  }

  footer{ color:var(--muted); font-size:.9rem; padding:8px 0 0 }
  </style>
</head>

<body>
  <div class="card">
    <h1>Sin’s Commission Queue</h1>
    <div class="sub">Keep every stone they throw at you, you have castles to build.</div>
    <p>
      <a class="btn btn-primary" href="https://ko-fi.com/sinchanted" target="_blank" rel="noopener">Ko-Fi</a>
      <a class="btn btn-ghost" href="mailto:sinchanted">Email</a>
    </p>
  </div>

  <img src="https://i.postimg.cc/8zhFPLPq/family-by-sinchanted-dhy1kk3-fullview.png" alt="Banner" style="width:min(1000px,96%); border-radius:16px; box-shadow:var(--shadow); border:1px solid var(--line)">

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Queue #</th>
          <th>Character</th>
          <th>Type</th>
          <th>ETA</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="queueTable">
        <tr><td colspan="5">Loading queue...</td></tr>
      </tbody>
    </table>
  </div>

  <footer>Last updated <span id="updatedAt">just now</span>.</footer>

  <script>
  async function fetchQueue() {
    const googleScriptURL = "https://script.google.com/macros/s/AKfycbw8WjBxkwLQj6irHpVBaLUf5NJ3ONgsUBqpLym3VJU86w70g5OGsKNzAE8LePLSzmjDNQ/exec?t=" + Date.now();

    const statusChip = (status) => {
      if (!status) return '<span class="chip queued"><i>•</i> Queued</span>';
      const s = String(status).toLowerCase();
      if (s.includes("wip") || s.includes("working") || s.includes("progress")) return '<span class="chip wip"><i>•</i> WIP</span>';
      if (s.includes("queue") || s.includes("queued")) return '<span class="chip queued"><i>•</i> Queued</span>';
      if (s.includes("paid")) return '<span class="chip paid"><i>•</i> Paid</span>';
      if (s.includes("sketch")) return '<span class="chip wip"><i>•</i> Sketching</span>';
      if (s.includes("line")) return '<span class="chip wip"><i>•</i> Lining</span>';
      if (s.includes("color")) return '<span class="chip wip"><i>•</i> Coloring</span>';
      if (s.includes("complete")) return '<span class="chip paid"><i>•</i> Completed</span>';
      return `<span class="chip queued"><i>•</i> ${escapeHtml(String(status))}</span>`;
    };

    const escapeHtml = (str) =>
      str.replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));

    try {
      const res = await fetch(googleScriptURL);
      const data = await res.json();

      const table = document.getElementById("queueTable");
      table.innerHTML = "";

      // hide completed
      const filtered = data.filter(o => String(o.status || "").toLowerCase() !== "completed");

      if (!filtered.length){
        table.innerHTML = "<tr><td colspan='5'>No active commissions.</td></tr>";
      } else {
        filtered.forEach(order => {
          const unpaid = String(order.paymentStatus || "").toLowerCase() === "not paid";
          const row = document.createElement("tr");
          if (unpaid) row.classList.add("not-paid");

          const cells = [
            { label: "Queue #", value: order.queueNumber ?? "—" },
            { label: "Character", value: escapeHtml(order.characterName ?? "—") },
            { label: "Type", value: escapeHtml(order.commissionType ?? "—") },
            { label: "ETA", value: escapeHtml(order.estimatedCompletionDate || "—") },
            { label: "Status", value: statusChip(order.status) }
          ];

          cells.forEach(c => {
            const td = document.createElement("td");
            td.setAttribute("data-label", c.label); // used by mobile cards
            td.innerHTML = c.value;
            row.appendChild(td);
          });

          table.appendChild(row);
        });
      }

      // Update timestamp
      const stamp = new Date();
      document.getElementById("updatedAt").textContent =
        stamp.toLocaleString([], {hour:'2-digit', minute:'2-digit'}) + " " +
        stamp.toLocaleDateString();

    } catch (err) {
      console.error("Error fetching queue:", err);
      document.getElementById("queueTable").innerHTML = "<tr><td colspan='5'>Failed to load queue.</td></tr>";
    }
  }

  fetchQueue();
  </script>
</body>
</html>
